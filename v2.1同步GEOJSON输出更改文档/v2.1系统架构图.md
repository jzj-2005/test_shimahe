# v2.1ç³»ç»Ÿæ¶æ„å›¾

**ç‰ˆæœ¬**: v2.1.0  
**æ›´æ–°**: 2026-02-25

---

## 1. æ•´ä½“ç³»ç»Ÿæ¶æ„

```mermaid
graph TB
    subgraph input [è¾“å…¥å±‚]
        Video[è§†é¢‘æº<br/>MP4/RTSP]
        OSD[ä½å§¿æ•°æ®<br/>SRT/MQTT/OCR]
    end
    
    subgraph detection [æ£€æµ‹å±‚]
        YOLODet[YOLOæ£€æµ‹å™¨<br/>YOLOv11x]
        CoordTrans[åæ ‡è½¬æ¢å™¨<br/>å¢å¼ºç‰ˆ/ç®€åŒ–ç‰ˆ]
    end
    
    subgraph output [è¾“å‡ºå±‚]
        CSVWriter[CSVå†™å…¥å™¨]
        ImageSaver[å›¾åƒä¿å­˜å™¨]
        ReportGen[æŠ¥å‘Šç”Ÿæˆå™¨]
    end
    
    subgraph postprocess [åå¤„ç†å±‚ v2.1æ–°å¢]
        PostProc[åå¤„ç†å™¨<br/>è‡ªåŠ¨è§¦å‘]
        Dedup[æ™ºèƒ½å»é‡<br/>ç©ºé—´+è´¨é‡]
        GeoJSON[GeoJSONå¯¼å‡º<br/>3ä¸ªç‰ˆæœ¬]
        MapGen[åœ°å›¾ç”Ÿæˆ<br/>Leaflet.js]
        Summary[ç»Ÿè®¡æ‘˜è¦<br/>åˆ†ææŠ¥å‘Š]
    end
    
    subgraph outputfiles [è¾“å‡ºæ–‡ä»¶]
        CSV[detections.csv<br/>åŸå§‹æ•°æ®]
        Images[æˆªå›¾æ–‡ä»¶<br/>JPG]
        GeoRaw[raw.geojson<br/>åŸå§‹]
        GeoUnique[unique.geojson<br/>å»é‡]
        GeoHigh[high_conf.geojson<br/>é«˜ç½®ä¿¡åº¦]
        Map[map.html<br/>äº¤äº’å¼åœ°å›¾]
        Sum[summary.txt<br/>ç»Ÿè®¡æŠ¥å‘Š]
    end
    
    Video --> YOLODet
    OSD --> CoordTrans
    YOLODet --> CoordTrans
    CoordTrans --> CSVWriter
    CoordTrans --> ImageSaver
    
    CSVWriter --> ReportGen
    ImageSaver --> ReportGen
    
    ReportGen -->|closeè§¦å‘| PostProc
    
    PostProc --> Dedup
    Dedup --> GeoJSON
    GeoJSON --> MapGen
    PostProc --> Summary
    
    CSVWriter --> CSV
    ImageSaver --> Images
    GeoJSON --> GeoRaw
    GeoJSON --> GeoUnique
    GeoJSON --> GeoHigh
    MapGen --> Map
    Summary --> Sum
    
    style input fill:#e3f2fd
    style detection fill:#f3e5f5
    style output fill:#e8f5e9
    style postprocess fill:#fff3e0
    style outputfiles fill:#fce4ec
```

---

## 2. æ™ºèƒ½å»é‡æµç¨‹å›¾

```mermaid
graph LR
    subgraph input_data [è¾“å…¥æ•°æ®]
        Raw[CSVåŸå§‹æ•°æ®<br/>Næ¡æ£€æµ‹]
    end
    
    subgraph dedup_process [å»é‡å¤„ç†]
        Score[è´¨é‡è¯„åˆ†<br/>4ä¸ªå› ç´ ]
        Filter[ä½è´¨é‡è¿‡æ»¤<br/>min_score]
        Group[ç©ºé—´åˆ†ç»„<br/>distance<5m]
        Select[é€‰æ‹©æœ€ä½³<br/>max_score]
    end
    
    subgraph output_data [è¾“å‡ºæ•°æ®]
        Unique[å»é‡æ•°æ®<br/>Mæ¡æ£€æµ‹<br/>M<<N]
    end
    
    Raw --> Score
    Score --> Filter
    Filter --> Group
    Group --> Select
    Select --> Unique
    
    Score -.è€ƒè™‘å› ç´ .-> Conf[ç½®ä¿¡åº¦]
    Score -.è€ƒè™‘å› ç´ .-> Edge[è¾¹ç¼˜ä½ç½®]
    Score -.è€ƒè™‘å› ç´ .-> GPS[GPSè´¨é‡]
    Score -.è€ƒè™‘å› ç´ .-> Error[å®šä½è¯¯å·®]
    
    style input_data fill:#e3f2fd
    style dedup_process fill:#fff3e0
    style output_data fill:#e8f5e9
```

---

## 3. æ•°æ®æµæ—¶åºå›¾

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant Pipeline as Pipeline
    participant Detector as æ£€æµ‹å™¨
    participant CSV as CSVå†™å…¥å™¨
    participant Report as ReportGenerator
    participant Post as PostProcessor
    participant Dedup as æ™ºèƒ½å»é‡
    participant Geo as GeoJSON
    participant Map as åœ°å›¾ç”Ÿæˆ
    
    User->>Pipeline: å¯åŠ¨æ£€æµ‹
    
    loop æ¯ä¸€å¸§
        Pipeline->>Detector: å¤„ç†è§†é¢‘å¸§
        Detector->>CSV: å†™å…¥æ£€æµ‹ç»“æœ
    end
    
    Pipeline->>Report: æ£€æµ‹å®Œæˆï¼Œè°ƒç”¨close()
    Report->>Post: è§¦å‘åå¤„ç†
    
    Post->>Post: è¯»å–CSVæ•°æ®
    Post->>Dedup: æ‰§è¡Œå»é‡
    Dedup->>Dedup: ç©ºé—´åˆ†ç»„
    Dedup->>Dedup: è´¨é‡è¯„åˆ†
    Dedup->>Dedup: é€‰æ‹©æœ€ä½³
    Dedup->>Post: è¿”å›å»é‡æ•°æ®
    
    Post->>Geo: å¯¼å‡ºGeoJSON
    Geo->>Geo: å¯¼å‡ºraw.geojson
    Geo->>Geo: å¯¼å‡ºunique.geojson
    Geo->>Geo: å¯¼å‡ºhigh_conf.geojson
    
    Post->>Map: ç”Ÿæˆåœ°å›¾
    Map->>Map: ç”Ÿæˆmap.html
    
    Post->>Post: ç”Ÿæˆsummary.txt
    Post->>Report: è¿”å›ç»“æœ
    Report->>Pipeline: å®Œæˆ
    Pipeline->>User: æ˜¾ç¤ºå®Œæˆä¿¡æ¯
    
    opt å¦‚æœé…ç½®äº†auto_open_map
        Report->>User: è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
    end
```

---

## 4. æ¨¡å—ä¾èµ–å…³ç³»å›¾

```mermaid
graph TB
    subgraph pipelines [Pipelineå±‚]
        OfflinePipe[OfflinePipeline]
        RealtimePipe[RealtimePipeline]
    end
    
    subgraph report [æŠ¥å‘Šå±‚]
        ReportGen[ReportGenerator]
    end
    
    subgraph postprocess [åå¤„ç†å±‚]
        PostProc[PostProcessor<br/>åè°ƒå™¨]
    end
    
    subgraph workers [å·¥ä½œæ¨¡å—]
        Dedup[DetectionDeduplicator<br/>å»é‡å™¨]
        GeoWriter[GeoJSONWriter<br/>GeoJSONå¯¼å‡º]
        MapGen[MapGenerator<br/>åœ°å›¾ç”Ÿæˆ]
    end
    
    subgraph config [é…ç½®]
        OffConf[offline_config.yaml]
        RealConf[realtime_config.yaml]
    end
    
    OffConf --> OfflinePipe
    RealConf --> RealtimePipe
    
    OfflinePipe --> ReportGen
    RealtimePipe --> ReportGen
    
    ReportGen --> PostProc
    
    PostProc --> Dedup
    PostProc --> GeoWriter
    PostProc --> MapGen
    
    style pipelines fill:#e3f2fd
    style report fill:#f3e5f5
    style postprocess fill:#fff3e0
    style workers fill:#e8f5e9
    style config fill:#fce4ec
```

---

## 5. é…ç½®é¡¹ç»“æ„å›¾

```mermaid
graph TB
    subgraph config_file [offline_config.yaml / realtime_config.yaml]
        Output[outputèŠ‚]
    end
    
    subgraph geojson_config [GeoJSONé…ç½®]
        GeoSwitch[export_geojson]
        GeoDir[geojson_dir]
        GeoMinConf[geojson_min_confidence]
        GeoHighConf[geojson_high_confidence]
    end
    
    subgraph dedup_config [å»é‡é…ç½®]
        DedupSwitch[enable_deduplication]
        DedupSub[deduplication]
        
        DedupDist[distance_threshold]
        DedupEdge[prefer_non_edge]
        DedupRTK[prefer_rtk]
        DedupScore[min_quality_score]
        DedupPenalty[edge_penalty]
    end
    
    subgraph map_config [åœ°å›¾é…ç½®]
        MapSwitch[generate_map]
        MapPath[map_output_path]
        MapAuto[auto_open_map]
    end
    
    subgraph summary_config [æ‘˜è¦é…ç½®]
        SumSwitch[generate_summary]
        SumPath[summary_path]
    end
    
    Output --> GeoSwitch
    Output --> GeoDir
    Output --> GeoMinConf
    Output --> GeoHighConf
    
    Output --> DedupSwitch
    Output --> DedupSub
    DedupSub --> DedupDist
    DedupSub --> DedupEdge
    DedupSub --> DedupRTK
    DedupSub --> DedupScore
    DedupSub --> DedupPenalty
    
    Output --> MapSwitch
    Output --> MapPath
    Output --> MapAuto
    
    Output --> SumSwitch
    Output --> SumPath
    
    style config_file fill:#e3f2fd
    style geojson_config fill:#e8f5e9
    style dedup_config fill:#fff3e0
    style map_config fill:#f3e5f5
    style summary_config fill:#fce4ec
```

---

## 6. è´¨é‡è¯„åˆ†ç®—æ³•å›¾

```mermaid
graph TB
    Detection[å•ä¸ªæ£€æµ‹]
    
    Detection --> BaseScore[åŸºç¡€è¯„åˆ†<br/>confidence]
    
    BaseScore --> EdgeCheck{is_on_edge?}
    EdgeCheck -->|æ˜¯| EdgePenalty[Ã—0.5<br/>è¾¹ç¼˜æƒ©ç½š]
    EdgeCheck -->|å¦| EdgeKeep[Ã—1.0<br/>ä¿æŒ]
    
    EdgePenalty --> GPSCheck[GPSè´¨é‡æ£€æŸ¥]
    EdgeKeep --> GPSCheck
    
    GPSCheck --> GPSWeight{gps_quality}
    GPSWeight -->|RTK| GPSBoost[Ã—1.2<br/>RTKåŠ æˆ]
    GPSWeight -->|HIGH| GPSNormal[Ã—1.0]
    GPSWeight -->|MEDIUM| GPSMid[Ã—0.9]
    GPSWeight -->|LOW| GPSLow[Ã—0.7]
    
    GPSBoost --> ErrorCheck[å®šä½è¯¯å·®æ£€æŸ¥]
    GPSNormal --> ErrorCheck
    GPSMid --> ErrorCheck
    GPSLow --> ErrorCheck
    
    ErrorCheck --> ErrorPenalty{estimated_error}
    ErrorPenalty -->|å¤§äº10m| Error1[Ã—0.8]
    ErrorPenalty -->|5-10m| Error2[Ã—0.9]
    ErrorPenalty -->|å°äº5m| Error3[Ã—1.0]
    
    Error1 --> FinalScore[æœ€ç»ˆè´¨é‡è¯„åˆ†]
    Error2 --> FinalScore
    Error3 --> FinalScore
    
    style Detection fill:#e3f2fd
    style BaseScore fill:#fff3e0
    style FinalScore fill:#e8f5e9
```

---

## 7. GeoJSONè¾“å‡ºç‰ˆæœ¬å¯¹æ¯”

```mermaid
graph TB
    subgraph input [è¾“å…¥æ•°æ®]
        CSVData[CSVæ–‡ä»¶<br/>æ‰€æœ‰æ£€æµ‹]
    end
    
    subgraph process [å¤„ç†æµç¨‹]
        ReadCSV[è¯»å–CSV]
        Dedup[æ™ºèƒ½å»é‡]
        FilterHigh[é«˜ç½®ä¿¡åº¦è¿‡æ»¤<br/>å¤§äº0.7]
    end
    
    subgraph output [è¾“å‡ºæ–‡ä»¶]
        RawGeo[detections_raw.geojson<br/>åŸå§‹å®Œæ•´æ•°æ®<br/>æ‰€æœ‰æ£€æµ‹]
        UniqueGeo[detections_unique.geojson<br/>æ™ºèƒ½å»é‡æ•°æ®<br/>æ¨èç”¨äºGIS]
        HighGeo[detections_high_conf.geojson<br/>é«˜ç½®ä¿¡åº¦æ•°æ®<br/>é‡ç‚¹åŒºåŸŸ]
    end
    
    CSVData --> ReadCSV
    
    ReadCSV --> RawGeo
    ReadCSV --> Dedup
    
    Dedup --> UniqueGeo
    Dedup --> FilterHigh
    
    FilterHigh --> HighGeo
    
    style input fill:#e3f2fd
    style process fill:#fff3e0
    style output fill:#e8f5e9
```

---

## 8. å®æ—¶æ¨¡å¼ vs ç¦»çº¿æ¨¡å¼å¯¹æ¯”

```mermaid
graph TB
    subgraph offline [ç¦»çº¿æ¨¡å¼]
        OffVideo[æœ¬åœ°è§†é¢‘<br/>MP4æ–‡ä»¶]
        OffOSD[SRTå­—å¹•<br/>æˆ–OCR]
        
        OffVideo --> OffDetect[æ£€æµ‹å¤„ç†]
        OffOSD --> OffDetect
        
        OffDetect --> OffOutput[è¾“å‡ºç»“æœ]
        OffOutput --> OffCSV[CSV]
        OffOutput --> OffGeo[GeoJSON 3ä¸ª]
        OffOutput --> OffMap[map.html]
        OffOutput --> OffSum[summary.txt]
        
        OffConfig[ç¦»çº¿é…ç½®<br/>å…¨åŠŸèƒ½å¼€å¯]
        OffConfig -.æ§åˆ¶.-> OffOutput
    end
    
    subgraph realtime [å®æ—¶æ¨¡å¼]
        RealRTSP[RTSPè§†é¢‘æµ]
        RealMQTT[MQTTä½å§¿]
        
        RealRTSP --> RealDetect[æ£€æµ‹å¤„ç†]
        RealMQTT --> RealDetect
        
        RealDetect --> RealOutput[è¾“å‡ºç»“æœ]
        RealOutput --> RealCSV[CSV<br/>è¿½åŠ æ¨¡å¼]
        RealOutput -.å¯é€‰.-> RealGeo[GeoJSON<br/>é»˜è®¤å…³é—­]
        RealOutput -.å¯é€‰.-> RealMap[map.html<br/>é»˜è®¤å…³é—­]
        RealOutput --> RealSum[summary.txt]
        
        RealConfig[å®æ—¶é…ç½®<br/>ä¿å®ˆé…ç½®]
        RealConfig -.æ§åˆ¶.-> RealOutput
    end
    
    style offline fill:#e8f5e9
    style realtime fill:#fff3e0
```

---

## 9. æ–‡ä»¶ç»„ç»‡ç»“æ„å›¾

```mermaid
graph TB
    Root[é¡¹ç›®æ ¹ç›®å½•]
    
    Root --> Src[src/]
    Root --> Config[config/]
    Root --> Data[data/]
    Root --> Docs[æ–‡æ¡£]
    Root --> Tests[æµ‹è¯•]
    
    Src --> Input[input/<br/>è¾“å…¥å±‚]
    Src --> Detection[detection/<br/>æ£€æµ‹å±‚]
    Src --> Transform[transform/<br/>è½¬æ¢å±‚]
    Src --> Output[output/<br/>è¾“å‡ºå±‚]
    
    Output --> CSVMod[csv_writer.py]
    Output --> ImgMod[image_saver.py]
    Output --> RepMod[report_generator.py]
    Output --> DedupMod[deduplication.py<br/>v2.1]
    Output --> GeoMod[geojson_writer.py<br/>v2.1]
    Output --> MapMod[map_generator.py<br/>v2.1]
    Output --> PostMod[post_processor.py<br/>v2.1]
    
    Config --> CamConf[camera_params.yaml]
    Config --> YoloConf[yolo_config.yaml]
    Config --> OffConf[offline_config.yaml<br/>v2.1æ›´æ–°]
    Config --> RealConf[realtime_config.yaml<br/>v2.1æ›´æ–°]
    
    Data --> DataOut[output/]
    DataOut --> CSVD[csv/]
    DataOut --> ImgD[images/]
    DataOut --> GeoD[geojson/<br/>v2.1æ–°å¢]
    DataOut --> MapF[map.html<br/>v2.1æ–°å¢]
    DataOut --> SumF[summary.txt<br/>v2.1æ–°å¢]
    
    Docs --> Doc1[GeoJSONè¾“å‡ºå’Œæ™ºèƒ½å»é‡å®ç°æ–‡æ¡£.md]
    Docs --> Doc2[GeoJSONå’Œåœ°å›¾è¾“å‡ºä½¿ç”¨æŒ‡å—.md]
    Docs --> Doc3[v2.1åŠŸèƒ½å¿«é€Ÿå¯åŠ¨æŒ‡å—.md]
    
    Tests --> Test1[test_post_processing.py]
    Tests --> Test2[verify_v2.1_installation.py]
    
    style Src fill:#e3f2fd
    style Output fill:#fff3e0
    style DedupMod fill:#ffeb3b
    style GeoMod fill:#ffeb3b
    style MapMod fill:#ffeb3b
    style PostMod fill:#ffeb3b
```

---

## 10. è´¨é‡è¯„åˆ†ç¤ºä¾‹æµç¨‹

```mermaid
graph TB
    Det[æ£€æµ‹è®°å½•<br/>confidence=0.85<br/>is_on_edge=false<br/>gps_quality=RTK<br/>error=0.8m]
    
    Det --> S1[åŸºç¡€åˆ†: 0.85]
    
    S1 --> S2{è¾¹ç¼˜æ£€æŸ¥}
    S2 -->|å¦| S2a[Ã—1.0<br/>score=0.85]
    
    S2a --> S3{GPSè´¨é‡}
    S3 -->|RTK| S3a[Ã—1.2<br/>score=1.02]
    
    S3a --> S4{å®šä½è¯¯å·®}
    S4 -->|å°äº5m| S4a[Ã—1.0<br/>score=1.02]
    
    S4a --> Final[æœ€ç»ˆè¯„åˆ†<br/>1.02]
    
    style Det fill:#e3f2fd
    style Final fill:#e8f5e9
```

---

## 11. åå¤„ç†è§¦å‘æœºåˆ¶

```mermaid
sequenceDiagram
    participant Main as main.py
    participant Pipe as Pipeline
    participant Report as ReportGenerator
    participant CSV as CSVWriter
    participant Post as PostProcessor
    
    Main->>Pipe: å¯åŠ¨
    Pipe->>Pipe: åˆå§‹åŒ–ç»„ä»¶
    
    Note over Pipe: æ£€æµ‹å¤„ç†ä¸­...
    
    Pipe->>Report: å†™å…¥æ£€æµ‹ç»“æœ
    Report->>CSV: é€è¡Œå†™å…¥
    
    Note over Pipe: ç”¨æˆ·æŒ‰ESCæˆ–æ£€æµ‹å®Œæˆ
    
    Pipe->>Report: finallyå—è°ƒç”¨close()
    Report->>CSV: å…³é—­CSVæ–‡ä»¶
    
    alt åå¤„ç†å·²å¯ç”¨
        Report->>Post: æ‰§è¡Œprocess()
        Post->>Post: è¯»å–CSV
        Post->>Post: æ™ºèƒ½å»é‡
        Post->>Post: å¯¼å‡ºGeoJSON
        Post->>Post: ç”Ÿæˆåœ°å›¾
        Post->>Post: ç”Ÿæˆæ‘˜è¦
        Post->>Report: è¿”å›ç»“æœ
    end
    
    Report->>Pipe: è¿”å›
    Pipe->>Main: å®Œæˆ
```

---

## 12. é…ç½®ä¼˜å…ˆçº§å†³ç­–æ ‘

```mermaid
graph TB
    Start{ä½¿ç”¨æ¨¡å¼?}
    
    Start -->|ç¦»çº¿æ¨¡å¼| Offline[ç¦»çº¿æ¨¡å¼]
    Start -->|å®æ—¶æ¨¡å¼| Realtime[å®æ—¶æ¨¡å¼]
    
    Offline --> OffScene{ä½¿ç”¨åœºæ™¯?}
    
    OffScene -->|æ—¥å¸¸å·¡æ£€| Daily[å…¨åŠŸèƒ½å¼€å¯<br/>auto_open_map=true]
    OffScene -->|æ•°æ®åˆ†æ| Analysis[å…³é—­å»é‡<br/>ä¿ç•™åŸå§‹æ•°æ®]
    OffScene -->|å¿«é€Ÿæµ‹è¯•| Quick[åªå¼€å¯æ‘˜è¦]
    
    Realtime --> RealTime{è¿è¡Œæ—¶é•¿?}
    
    RealTime -->|çŸ­å°äº30åˆ†é’Ÿ| Short[å¯å¼€å¯GeoJSON<br/>å¿…é¡»å¼€å¯å»é‡]
    RealTime -->|é•¿å¤§äº1å°æ—¶| Long[å…³é—­GeoJSON<br/>åªå¼€å¯æ‘˜è¦]
    
    Daily --> Result1[æ¨èé…ç½®]
    Analysis --> Result2[åˆ†æé…ç½®]
    Quick --> Result3[æµ‹è¯•é…ç½®]
    Short --> Result4[å®æ—¶çŸ­é…ç½®]
    Long --> Result5[å®æ—¶é•¿é…ç½®]
    
    style Start fill:#e3f2fd
    style Offline fill:#e8f5e9
    style Realtime fill:#fff3e0
```

---

## 13. è¾“å‡ºæ–‡ä»¶ä½¿ç”¨æµç¨‹

```mermaid
graph TB
    Complete[æ£€æµ‹å®Œæˆ<br/>è‡ªåŠ¨ç”Ÿæˆæ‰€æœ‰æ–‡ä»¶]
    
    Complete --> UseCase{ä½¿ç”¨åœºæ™¯}
    
    UseCase -->|å¿«é€ŸæŸ¥çœ‹| Map[æ‰“å¼€map.html<br/>æµè§ˆå™¨æŸ¥çœ‹]
    UseCase -->|äº†è§£ç»Ÿè®¡| Summary[æ‰“å¼€summary.txt<br/>æŸ¥çœ‹æ¦‚è§ˆ]
    UseCase -->|GISåˆ†æ| GIS[QGIS/ArcGIS<br/>å¯¼å…¥unique.geojson]
    UseCase -->|æ•°æ®å®¡æ ¸| CSV[Excelæ‰“å¼€<br/>detections.csv]
    UseCase -->|æŠ¥å‘Šæ±‡æŠ¥| Export[æ‰“åŒ…äº¤ä»˜<br/>åœ°å›¾+GeoJSON+æ‘˜è¦]
    
    Map --> MapAction[æŸ¥çœ‹æ£€æµ‹åˆ†å¸ƒ<br/>ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…]
    Summary --> SumAction[äº†è§£ç±»åˆ«ç»Ÿè®¡<br/>GPSè´¨é‡åˆ†å¸ƒ]
    GIS --> GISAction[ç©ºé—´åˆ†æ<br/>çƒ­åŠ›å›¾ç”Ÿæˆ]
    CSV --> CSVAction[è¯¦ç»†æ•°æ®æŸ¥çœ‹<br/>ç­›é€‰å’Œæ’åº]
    Export --> ExportAction[ç”ŸæˆæŠ¥å‘Š<br/>æäº¤å®¢æˆ·]
    
    style Complete fill:#e3f2fd
    style UseCase fill:#fff3e0
```

---

## 14. æŠ€æœ¯æ ˆå±‚æ¬¡å›¾

```mermaid
graph TB
    subgraph core [æ ¸å¿ƒæ£€æµ‹ - v1.0]
        YOLOv11[YOLOv11x<br/>ç›®æ ‡æ£€æµ‹]
        PyTorch[PyTorch<br/>æ·±åº¦å­¦ä¹ æ¡†æ¶]
        OpenCV[OpenCV<br/>è§†é¢‘å¤„ç†]
    end
    
    subgraph coord [åæ ‡è½¬æ¢ - v2.0]
        CoordNew[å¢å¼ºç‰ˆè½¬æ¢<br/>3Då§¿æ€ä¿®æ­£]
        PyProj[pyproj<br/>åæ ‡ç³»è½¬æ¢]
        Scipy[scipy.spatial<br/>æ—‹è½¬çŸ©é˜µ]
    end
    
    subgraph postproc [åå¤„ç† - v2.1]
        Dedup[æ™ºèƒ½å»é‡<br/>ç©ºé—´+è´¨é‡]
        GeoJSON[GeoJSON<br/>RFC 7946]
        Leaflet[Leaflet.js<br/>äº¤äº’å¼åœ°å›¾]
    end
    
    subgraph data [æ•°æ®å¤„ç†]
        Pandas[pandas<br/>DataFrame]
        Numpy[numpy<br/>æ•°å€¼è®¡ç®—]
    end
    
    subgraph support [æ”¯æŒåº“]
        Loguru[loguru<br/>æ—¥å¿—]
        YAML[PyYAML<br/>é…ç½®]
        Paho[paho-mqtt<br/>å®æ—¶é€šä¿¡]
    end
    
    YOLOv11 --> CoordNew
    CoordNew --> Dedup
    Dedup --> GeoJSON
    GeoJSON --> Leaflet
    
    Pandas --> Dedup
    Numpy --> Dedup
    
    PyTorch -.ä¾èµ–.- YOLOv11
    PyProj -.ä¾èµ–.- CoordNew
    Scipy -.ä¾èµ–.- CoordNew
    
    style core fill:#e3f2fd
    style coord fill:#f3e5f5
    style postproc fill:#fff3e0
    style data fill:#e8f5e9
    style support fill:#fce4ec
```

---

## 15. æ•°æ®è½¬æ¢æµç¨‹å›¾

```mermaid
graph LR
    subgraph detect [æ£€æµ‹æ•°æ®]
        Pixel[åƒç´ åæ ‡<br/>x,y,w,h]
    end
    
    subgraph coord_trans [åæ ‡è½¬æ¢]
        Camera[ç›¸æœºæ¨¡å‹<br/>å†…å‚+ç•¸å˜]
        Attitude[æ— äººæœºå§¿æ€<br/>yaw,pitch,roll]
        GPS1[æ— äººæœºGPS<br/>WGS84]
        
        Pixel --> Camera
        Camera --> Ray[è§†çº¿å‘é‡]
        Ray --> Attitude
        Attitude --> Ground[åœ°é¢äº¤ç‚¹]
        Ground --> GPS1
        GPS1 --> Transform[åæ ‡ç³»è½¬æ¢]
        Transform --> GPS2[ç›®æ ‡GPS<br/>CGCS2000]
    end
    
    subgraph csv_out [CSVè¾“å‡º]
        GPS2 --> CSVFile[CSVæ–‡ä»¶<br/>å«GPSè´¨é‡]
    end
    
    subgraph post [åå¤„ç†]
        CSVFile --> Dedup[æ™ºèƒ½å»é‡]
        Dedup --> GeoOut[GeoJSONè¾“å‡º]
        GeoOut --> Geo1[raw.geojson]
        GeoOut --> Geo2[unique.geojson]
        GeoOut --> Geo3[high_conf.geojson]
    end
    
    subgraph vis [å¯è§†åŒ–]
        Geo2 --> MapHTML[map.html<br/>Leafletåœ°å›¾]
    end
    
    style detect fill:#e3f2fd
    style coord_trans fill:#f3e5f5
    style csv_out fill:#fff3e0
    style post fill:#e8f5e9
    style vis fill:#fce4ec
```

---

## ä½¿ç”¨è¯´æ˜

### å¦‚ä½•é˜…è¯»è¿™äº›å›¾è¡¨

1. **æ•´ä½“æ¶æ„å›¾**ï¼šäº†è§£ç³»ç»Ÿæ•´ä½“ç»“æ„
2. **æ™ºèƒ½å»é‡æµç¨‹å›¾**ï¼šç†è§£å»é‡å·¥ä½œåŸç†
3. **æ•°æ®æµæ—¶åºå›¾**ï¼šäº†è§£æ‰§è¡Œæ—¶åº
4. **æ¨¡å—ä¾èµ–å…³ç³»å›¾**ï¼šç†è§£æ¨¡å—ä¹‹é—´çš„å…³ç³»
5. **é…ç½®é¡¹ç»“æ„å›¾**ï¼šäº†è§£é…ç½®æ–‡ä»¶ç»“æ„
6. **è´¨é‡è¯„åˆ†ç®—æ³•å›¾**ï¼šç†è§£è¯„åˆ†è®¡ç®—è¿‡ç¨‹
7. **GeoJSONè¾“å‡ºç‰ˆæœ¬å¯¹æ¯”**ï¼šç†è§£3ä¸ªç‰ˆæœ¬çš„å·®å¼‚
8. **æ¨¡å¼å¯¹æ¯”å›¾**ï¼šç†è§£ç¦»çº¿å’Œå®æ—¶æ¨¡å¼çš„å·®å¼‚
9. **æ–‡ä»¶ç»„ç»‡ç»“æ„å›¾**ï¼šäº†è§£æ–‡ä»¶å¸ƒå±€
10. **è¾“å‡ºæ–‡ä»¶ä½¿ç”¨æµç¨‹**ï¼šäº†è§£å¦‚ä½•ä½¿ç”¨è¾“å‡ºæ–‡ä»¶

### å›¾è¡¨é˜…è¯»é¡ºåº

**å¿«é€Ÿäº†è§£**ï¼ˆ10åˆ†é’Ÿï¼‰ï¼š
1. æ•´ä½“æ¶æ„å›¾
2. æ™ºèƒ½å»é‡æµç¨‹å›¾
3. è¾“å‡ºæ–‡ä»¶ä½¿ç”¨æµç¨‹

**æ·±å…¥ç†è§£**ï¼ˆ30åˆ†é’Ÿï¼‰ï¼š
4. æ•°æ®æµæ—¶åºå›¾
5. æ¨¡å—ä¾èµ–å…³ç³»å›¾
6. è´¨é‡è¯„åˆ†ç®—æ³•å›¾

**é…ç½®æŒ‡å¯¼**ï¼ˆ10åˆ†é’Ÿï¼‰ï¼š
7. é…ç½®é¡¹ç»“æ„å›¾
8. é…ç½®ä¼˜å…ˆçº§å†³ç­–æ ‘
9. æ¨¡å¼å¯¹æ¯”å›¾

---

## é…åˆæ–‡æ¡£ä½¿ç”¨

æœ¬æ¶æ„å›¾é…åˆä»¥ä¸‹æ–‡æ¡£ä½¿ç”¨æ•ˆæœæœ€ä½³ï¼š

- ğŸ“˜ **æŠ€æœ¯å®ç°**: `GeoJSONè¾“å‡ºå’Œæ™ºèƒ½å»é‡å®ç°æ–‡æ¡£.md`
- ğŸ“— **æ“ä½œæ‰‹å†Œ**: `GeoJSONå’Œåœ°å›¾è¾“å‡ºä½¿ç”¨æŒ‡å—.md`
- ğŸ“™ **å¿«é€ŸæŒ‡å—**: `v2.1åŠŸèƒ½å¿«é€Ÿå¯åŠ¨æŒ‡å—.md`

---

**åˆ›å»ºæ—¶é—´**: 2026-02-25  
**é€‚ç”¨ç‰ˆæœ¬**: v2.1.0+  
**æ–‡æ¡£ç±»å‹**: æ¶æ„å‚è€ƒ
