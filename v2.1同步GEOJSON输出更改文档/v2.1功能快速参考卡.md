# v2.1功能快速参考卡

**版本**: v2.1.0 | **日期**: 2026-02-25 | **状态**: ✅ 可用

---

## 🚀 新增功能（一目了然）

| 功能 | 说明 | 配置开关 | 默认状态 |
|------|------|---------|---------|
| **智能去重** | 自动去除重复检测，保留最佳 | `enable_deduplication` | ✅ 开启 |
| **GeoJSON导出** | 3个版本GIS矢量数据 | `export_geojson` | ✅ 开启 |
| **HTML地图** | Leaflet交互式地图 | `generate_map` | ✅ 开启 |
| **统计摘要** | 数据分析报告 | `generate_summary` | ✅ 开启 |

---

## ⚡ 30秒快速开始

```bash
# 1. 运行检测（自动生成所有输出）
python src/main.py --mode offline --video test.mp4

# 2. 查看地图
start data\output\map.html

# 3. 查看摘要
notepad data\output\summary.txt

# 完成！
```

---

## 📁 输出文件位置

```
data/output/
├── csv/detections_offline.csv                # CSV原始数据
├── geojson/
│   ├── detections_raw.geojson                # 原始完整
│   ├── detections_unique.geojson             # 去重（推荐GIS）
│   └── detections_high_conf.geojson          # 高置信度
├── map.html                                  # 交互式地图
└── summary.txt                               # 统计摘要
```

---

## 🎛️ 关键配置

### 离线模式（推荐配置）

```yaml
# config/offline_config.yaml
output:
  export_geojson: true
  enable_deduplication: true
  generate_map: true
  auto_open_map: true              # 自动打开地图
```

### 实时模式（保守配置）

```yaml
# config/realtime_config.yaml
output:
  export_geojson: false            # 数据量大
  enable_deduplication: true       # 必须开启
  generate_map: false
  generate_summary: true
```

### 去重参数调整

```yaml
deduplication:
  distance_threshold: 5.0          # 3-10米可调
  min_quality_score: 0.3           # 0.2-0.5可调
```

---

## 📊 效果对比

| 指标 | v2.0 | v2.1 | 改进 |
|------|------|------|------|
| 输出格式 | 2种 | 5种 | +3种 |
| 数据冗余 | 严重 | 已解决 | ↓70-97% |
| GIS支持 | 需转换 | 直接导入 | 自动化 |
| 可视化 | 需手动 | 自动生成 | 0步骤 |
| 统计分析 | 无 | 自动生成 | 新增 |

---

## 🔍 智能去重速查

### 去重原理

```
同一目标100次检测 → 空间分组 → 质量评分 → 保留最佳1次
```

### 质量评分因素

1. ✅ **置信度**（基础分）
2. ✅ **边缘位置**（完整性）
3. ✅ **GPS质量**（RTK优先）
4. ✅ **定位误差**（精度）

### 配置示例

```yaml
# 更严格（去除更多）
distance_threshold: 3.0
min_quality_score: 0.5

# 更宽松（保留更多）
distance_threshold: 10.0
min_quality_score: 0.2

# 完全关闭
enable_deduplication: false
```

---

## 🗺️ GeoJSON速查

### 三个版本

| 文件 | 内容 | 用途 |
|------|------|------|
| `raw.geojson` | 所有检测 | 审计、分析 |
| `unique.geojson` | 去重后 | **GIS展示（推荐）** |
| `high_conf.geojson` | 高置信度 | 重点区域 |

### GIS软件导入

```
QGIS:
图层 → 添加矢量图层 → 选择 detections_unique.geojson

ArcGIS:
Add Data → 选择 .geojson 文件
```

### 坐标系

- 坐标系: CGCS2000 (EPSG:4490)
- 几何: Polygon（检测框四角点）
- 坐标顺序: [经度, 纬度] ⚠️

---

## 🌐 地图速查

### 查看方式

```bash
# 自动打开（配置中设置）
auto_open_map: true

# 手动打开
start data\output\map.html
```

### 地图功能

- 🗺️ OpenStreetMap底图
- 🎨 类别颜色编码
- 📊 置信度透明度
- 🖱️ 点击查看详情
- 📍 图例和统计

---

## 📈 统计摘要速查

### 查看方式

```bash
notepad data\output\summary.txt
```

### 包含信息

- 数据概览（原始、去重、去重率）
- 类别统计（数量、占比）
- 置信度统计（平均、范围）
- GPS质量统计（RTK/HIGH/MEDIUM）
- 地理范围（覆盖面积）
- 边缘检测统计

---

## 🛠️ 故障排查速查

### 问题：未生成GeoJSON

```bash
# 检查配置
export_geojson: true  # 确认为true

# 检查CSV
ls -lh data/output/csv/detections_offline.csv  # 确认有数据
```

### 问题：地图空白

```bash
# 检查网络（需加载Leaflet.js）
# 换浏览器（Chrome、Firefox）
# 查看浏览器控制台（F12）
```

### 问题：去重太少/太多

```yaml
# 去重太多 → 增大阈值
distance_threshold: 10.0

# 去重太少 → 减小阈值
distance_threshold: 3.0
```

---

## 📚 文档速查

| 需求 | 文档 | 时间 |
|------|------|------|
| 快速上手 | v2.1功能快速启动指南.md | 5分钟 |
| 详细操作 | GeoJSON和地图输出使用指南.md | 30分钟 |
| 技术实现 | GeoJSON输出和智能去重实现文档.md | 1小时 |
| 版本更新 | CHANGELOG_v2.1.md | 10分钟 |

---

## 🧪 测试速查

### 验证安装

```bash
python verify_v2.1_installation.py
# 预期：29/29项通过
```

### 测试功能

```bash
python test_post_processing.py
# 预期：生成测试文件
```

### Windows测试

```bash
test_v2.1_features.bat
# 预期：交互式测试流程
```

---

## ⚙️ 性能速查

### 后处理耗时

| 数据量 | 耗时 | 占比 |
|--------|------|------|
| 100条 | 0.4秒 | 1% |
| 1000条 | 1.2秒 | 1% |
| 10000条 | 11秒 | 1% |

### 去重效果

| 场景 | 去重率 |
|------|--------|
| 离线5分钟 | 70% |
| 实时1小时 | 97% |

---

## 🎯 配置速查表

### 功能开关

```yaml
output:
  export_geojson: true/false
  enable_deduplication: true/false
  generate_map: true/false
  auto_open_map: true/false
  generate_summary: true/false
```

### 去重参数

```yaml
deduplication:
  distance_threshold: 5.0          # 3-10米
  min_quality_score: 0.3           # 0.2-0.5
  prefer_non_edge: true/false
  prefer_rtk: true/false
  edge_penalty: 0.5                # 0.3-1.0
```

### 推荐配置组合

| 场景 | 配置 |
|------|------|
| **日常巡检** | 全部开启 + auto_open_map |
| **数据分析** | 全部开启 + 关闭去重 |
| **快速测试** | 只开启摘要 |
| **实时长时** | 关闭GeoJSON和地图 |

---

## 📞 支持速查

### 日志位置

```
data/output/offline_log.txt
data/output/realtime_log.txt
```

### 关键日志

```
[INFO] 开始后处理...
[INFO] 去重完成: X -> Y 条
[INFO] ✓ 导出GeoJSON: ...
[INFO] ✓ 生成地图: ...
[INFO] ✓ 后处理完成
```

### 联系方式

- 技术问题：查看技术实现文档
- 使用问题：查看使用指南
- 其他问题：提供日志和配置文件

---

## ✅ 检查清单

### 运行前

- [ ] 配置已确认
- [ ] 视频已准备
- [ ] 环境已激活

### 运行后

- [ ] 检测完成无错误
- [ ] GeoJSON已生成（3个文件）
- [ ] 地图可正常打开
- [ ] 摘要信息准确

### 验证

- [ ] 地图显示正确
- [ ] GIS可导入
- [ ] 去重效果合理
- [ ] 统计数据准确

---

**保存此卡片以便随时参考**

**完整文档**: `GeoJSON和地图输出使用指南.md`  
**技术文档**: `GeoJSON输出和智能去重实现文档.md`  
**快速指南**: `v2.1功能快速启动指南.md`
