# M3TD/M4TD 相机参数获取指南

**目标**：获取准确的相机参数以提高GPS坐标转换精度  
**设备**：DJI M3TD / M4TD  
**重要性**：⭐⭐⭐⭐⭐ 直接影响坐标精度（参数错误可导致50-100米偏差）

---

## 一、需要获取的参数清单

### 必需参数（⭐⭐⭐⭐⭐ 必须准确）

| 参数名称 | 说明 | 当前值（可能不准确） | 影响程度 |
|---------|------|-------------------|---------|
| **分辨率 (Resolution)** | 图像宽度×高度（像素） | 5472×3648 | ⭐⭐⭐⭐⭐ |
| **传感器尺寸 (Sensor Size)** | 物理传感器尺寸（毫米） | 13.2mm × 8.8mm | ⭐⭐⭐⭐⭐ |
| **焦距 (Focal Length)** | 镜头焦距（毫米） | 8.8mm | ⭐⭐⭐⭐⭐ |

### 次要参数（⭐⭐⭐ 可使用默认值）

| 参数名称 | 说明 | 默认值 |
|---------|------|--------|
| 主点坐标 (Principal Point) | 光轴与传感器交点 | 图像中心 (cx=width/2, cy=height/2) |
| 畸变系数 (Distortion) | 镜头畸变参数 | 0（暂不考虑畸变） |

---

## 二、获取方法（按推荐程度排序）

### 方法1：查看DJI官方技术规格 ⭐⭐⭐⭐⭐（最准确）

#### 步骤1：访问DJI官网产品页面

**M3TD**:
```
URL: https://enterprise.dji.com/matrice-3td
或搜索: "DJI Matrice 3TD specifications"
```

**M4TD**:
```
URL: https://enterprise.dji.com/matrice-4td
或搜索: "DJI Matrice 4TD specifications"
```

#### 步骤2：查找以下信息

在产品页面的"技术参数"或"Specifications"部分找到：

**广角相机参数**（用于巡检拍摄的相机）：

```
需要查找的关键词（中英文）：
- 传感器: "CMOS" / "Sensor"
- 有效像素: "Effective Pixels" / "分辨率"
- 传感器尺寸: "Sensor Size" / "1/1.x inch"
- 焦距: "Focal Length" / "FOV"
- 等效焦距: "35mm Format Equivalent"
```

**典型参数示例**（参考M3TD）：

```yaml
相机型号: 广角相机 (Wide Camera)
传感器: 1/1.32英寸 CMOS
有效像素: 48MP (8000×6000) 或 20MP (5472×3648)
焦距: 4mm - 8mm (变焦镜头) 或固定焦距
视场角: 84° / 56°
```

#### 步骤3：转换传感器尺寸

**传感器英寸 → 物理尺寸（毫米）对照表**：

| 传感器标注 | 物理宽度(mm) | 物理高度(mm) | 对角线(mm) |
|----------|-------------|-------------|-----------|
| 1/1.2" | 13.2 | 8.8 | 15.9 |
| 1/1.28" | 12.8 | 9.6 | 16.0 |
| 1/1.32" | 12.4 | 9.3 | 15.5 |
| 1/1.7" | 9.5 | 7.1 | 11.9 |
| 1/2" | 8.0 | 6.0 | 10.0 |
| 1/2.3" | 6.17 | 4.55 | 7.7 |

**计算公式**（如果对照表没有）：
```
对角线(mm) = 16 / 传感器英寸数
宽度 = 对角线 × 0.83
高度 = 对角线 × 0.55
```

**示例**：
```
如果规格显示: 1/1.32英寸 CMOS
→ 对角线 = 16 / 1.32 = 12.1mm
→ 宽度 = 12.1 × 0.83 ≈ 10.0mm
→ 高度 = 12.1 × 0.55 ≈ 6.7mm

或直接查对照表: 12.4mm × 9.3mm
```

#### 步骤4：记录参数

```yaml
# 记录实际参数
相机型号: M3TD / M4TD 广角相机
传感器: 1/___英寸 CMOS
有效像素: _______ MP
分辨率: _____ × _____ 像素
传感器尺寸: _____ × _____ mm
焦距: _____ mm
```

---

### 方法2：查看DJI Pilot 2 App ⭐⭐⭐⭐（推荐）

#### 操作步骤：

1. **连接M3TD/M4TD设备**
   - 开机并连接遥控器
   - 打开DJI Pilot 2 App

2. **进入相机设置**
   ```
   路径: 相机图标 → 设置 ⚙️ → 相机参数
   ```

3. **查看当前设置**
   - **照片分辨率**: 例如 5472×3648
   - **相机模式**: 例如 广角、变焦
   - **焦距信息**: 如果是变焦镜头，查看当前焦距

4. **查看设备信息**
   ```
   路径: 设置 → 关于 → 设备信息
   ```
   - 可能显示相机型号和传感器信息

#### 注意事项：
- ⚠️ 确保查看的是**实际用于巡检拍摄的相机**
- ⚠️ M3TD有多个相机（广角、变焦、红外），确认使用哪个
- ⚠️ 记录**实际拍摄时的分辨率设置**

---

### 方法3：从照片EXIF信息提取 ⭐⭐⭐⭐（可靠）

#### 前提条件：
需要M3TD/M4TD拍摄的**照片文件**（不是视频截图）

#### 操作步骤：

**方法A：使用ExifTool（推荐）**

1. **下载安装ExifTool**
   ```
   Windows: https://exiftool.org/
   下载后解压到任意目录
   ```

2. **运行命令查看EXIF**
   ```bash
   # 方法1: 直接拖拽图片到exiftool.exe
   # 或使用命令行：
   exiftool.exe "DJI_0001.JPG" > camera_info.txt
   ```

3. **查找关键信息**
   
   在输出的文本中查找：
   
   ```
   Image Width                     : 5472      # ← 分辨率宽度
   Image Height                    : 3648      # ← 分辨率高度
   Focal Length                    : 8.8 mm    # ← 焦距
   Focal Length In 35mm Format     : 24 mm     # ← 等效焦距
   Make                            : DJI
   Camera Model Name               : M3TD       # ← 相机型号
   Sensor Size                     : ?          # ← 可能有，可能没有
   ```

4. **传感器尺寸计算**（如果EXIF中没有）
   
   使用等效焦距反推：
   ```
   等效焦距 = 实际焦距 × (36 / 传感器对角线)
   
   已知：
   - 实际焦距 = 8.8mm
   - 等效焦距 = 24mm
   
   计算：
   传感器对角线 = 36 × 8.8 / 24 = 13.2mm
   
   查对照表得: 1/1.2英寸传感器
   物理尺寸: 13.2mm × 8.8mm
   ```

**方法B：使用Windows属性查看**

1. 右键点击照片 → 属性
2. 切换到"详细信息"选项卡
3. 查看"相机"部分的信息

**方法C：使用在线工具**

上传照片到：
```
https://www.metadata2go.com/
或
https://exifdata.com/
```

---

### 方法4：查看用户手册 ⭐⭐⭐

#### 位置：
```
DJI官网 → 支持 → 下载 → 用户手册
或随机附带的纸质/电子手册
```

#### 查找章节：
```
技术参数 / Technical Specifications
相机系统 / Camera System
```

---

### 方法5：联系DJI技术支持 ⭐⭐⭐

#### 联系方式：

**DJI企业版技术支持**:
```
官网: https://enterprise.dji.com/cn/support
电话: 400-700-0303（中国）
邮箱: enterprisesupport@dji.com
在线客服: 官网右下角聊天窗口
```

**咨询内容**：
```
"您好，我们在使用M3TD/M4TD进行测绘应用，
需要确认以下相机参数用于坐标转换：
1. 传感器物理尺寸（毫米）
2. 镜头焦距（毫米）
3. 实际拍摄分辨率

请问能否提供准确参数？谢谢！"
```

---

## 三、参数验证与修正

### 方法1：使用已知地标验证

#### 步骤：

1. **选择3-5个已知地标**
   ```
   要求：
   - 位置明确（如桥梁角点、建筑物角点）
   - 有高精度GPS坐标（可使用高德地图/谷歌地图测量）
   - 在视频中清晰可见
   ```

2. **进行检测并记录**
   ```
   运行系统 → 检测地标 → 记录计算的GPS坐标
   ```

3. **计算误差**
   ```
   误差 = |计算坐标 - 实际坐标|
   
   如果误差 > 10米：相机参数可能错误
   如果误差 5-10米：参数基本正确，可能需微调
   如果误差 < 5米：参数准确 ✅
   ```

4. **参数微调**
   
   **如果误差偏大**：
   ```yaml
   # 尝试调整焦距（±10%范围）
   # 原值：8.8mm
   focal_length: 8.0  # 减小焦距 → 目标距离变近
   或
   focal_length: 9.6  # 增大焦距 → 目标距离变远
   ```
   
   **如果误差方向一致**：
   ```yaml
   # 所有目标都向东偏移50米 → 添加系统性修正
   # 在 coord_transform.py 中添加：
   target_lon = target_lon - 0.00045  # 约50米修正
   ```

### 方法2：与已知测绘数据对比

如果有：
- 已有的测绘数据
- RTK差分GPS测量结果
- 其他高精度定位系统数据

可以对比验证当前参数的准确性。

---

## 四、不同相机的参数配置

### M3TD 可能的相机配置

M3TD配备多个相机，需要确认使用哪个：

#### 相机1：广角相机（主要用于巡检）

```yaml
camera:
  model: "M3TD_Wide"
  resolution:
    width: 5472      # 或 8000（取决于设置）
    height: 3648     # 或 6000
  sensor_size:
    width: 13.2      # 估算值，需确认
    height: 8.8
  focal_length: 4.5  # 估算值，需确认
```

#### 相机2：变焦相机

```yaml
camera:
  model: "M3TD_Zoom"
  resolution:
    width: 4000
    height: 3000
  sensor_size:
    width: 6.17      # 1/2.3英寸
    height: 4.55
  focal_length: 20   # 变焦镜头，取决于变焦倍率
```

### M4TD 可能的相机配置

M4TD是较新型号，参数可能与M3TD不同：

```yaml
camera:
  model: "M4TD"
  resolution:
    width: 5472      # 待确认
    height: 3648
  sensor_size:
    width: 13.2      # 待确认
    height: 8.8
  focal_length: 8.8  # 待确认
```

---

## 五、修改配置文件

### 获取准确参数后的修改步骤：

#### 步骤1：备份当前配置

```bash
cd config
copy camera_params.yaml camera_params.yaml.backup
```

#### 步骤2：修改配置

**文件**: `config/camera_params.yaml`

```yaml
camera:
  model: "M3TD"  # 或 "M4TD"
  
  # ========== 修改为实际参数 ==========
  resolution:
    width: 5472      # ← 从EXIF或官方规格获取
    height: 3648     # ← 从EXIF或官方规格获取
  
  sensor_size:
    width: 13.2      # ← 从传感器尺寸对照表获取
    height: 8.8      # ← 从传感器尺寸对照表获取
  
  focal_length: 8.8  # ← 从EXIF或官方规格获取
  
  # ========== 主点坐标（通常为图像中心）==========
  principal_point:
    cx: 2736         # width / 2
    cy: 1824         # height / 2
```

#### 步骤3：验证配置

```bash
# 重新运行检测
python run_offline.py "测试视频.MP4"

# 生成地图验证
python tools/quick_visualize.py

# 检查GPS坐标是否合理
```

---

## 六、参数获取记录表

**请填写实际获取的参数**：

```
========== M3TD/M4TD 相机参数记录 ==========

获取日期: 2026年__月__日
获取人员: ___________
获取方法: ☐ DJI官网  ☐ DJI Pilot  ☐ EXIF  ☐ 手册  ☐ 技术支持

一、设备信息
  设备型号: ☐ M3TD  ☐ M4TD
  使用相机: ☐ 广角  ☐ 变焦  ☐ 其他:_______
  
二、分辨率
  图像宽度: _______ 像素
  图像高度: _______ 像素
  来源: ☐ EXIF  ☐ Pilot设置  ☐ 官方规格

三、传感器尺寸
  传感器标注: 1/___ 英寸 CMOS
  物理宽度: _______ mm
  物理高度: _______ mm
  来源: ☐ 对照表转换  ☐ 官方规格  ☐ 计算

四、焦距
  实际焦距: _______ mm
  等效焦距: _______ mm (35mm格式)
  来源: ☐ EXIF  ☐ 官方规格  ☐ 手册

五、验证结果
  测试地标数量: ___ 个
  平均GPS误差: _______ 米
  是否合格(< 5米): ☐ 是  ☐ 否

六、备注
  ________________________________
  ________________________________

========== 记录完成 ==========
```

---

## 七、常见问题

### Q1：M3TD有多个相机，应该用哪个的参数？

**A**：使用**实际用于巡检拍摄的相机**参数。

- 如果使用广角相机拍摄 → 使用广角相机参数
- 如果使用变焦相机拍摄 → 使用变焦相机参数（注意焦距会变化）
- 建议：巡检统一使用广角相机，焦距固定

### Q2：变焦镜头如何设置焦距？

**A**：
- 方法1：固定变焦倍率（推荐），例如1倍或2倍
- 方法2：从EXIF中读取每张照片的实际焦距
- 建议：巡检时使用固定焦距，便于参数配置

### Q3：如果实在获取不到准确参数怎么办？

**A**：使用标定法：

1. 在地面放置标定板（已知尺寸）
2. 从已知高度拍摄
3. 测量标定板在图像中的像素尺寸
4. 反推相机参数

或联系我们提供标定工具。

### Q4：参数错误会导致多大误差？

**A**：
```
焦距错误10%  → GPS误差约10%  
传感器尺寸错误10%  → GPS误差约10%
分辨率错误  → GPS误差可达50-100米

示例：
- 飞行高度100米
- 焦距8.8mm错误为9.5mm (误差8%)
- 导致GPS坐标误差约8米
```

---

## 八、推荐操作流程

**第一步（1小时）**：
```
☐ 访问DJI官网查看M3TD/M4TD技术规格
☐ 记录分辨率、传感器、焦距
☐ 使用对照表转换传感器尺寸
```

**第二步（30分钟）**：
```
☐ 用M3TD/M4TD拍摄一张测试照片
☐ 使用ExifTool提取EXIF信息
☐ 验证第一步获取的参数
```

**第三步（30分钟）**：
```
☐ 修改 config/camera_params.yaml
☐ 使用测试视频运行检测
☐ 生成地图查看结果
```

**第四步（1小时）**：
```
☐ 选择2-3个已知地标
☐ 对比计算坐标与实际坐标
☐ 如果误差 < 5米，参数正确 ✅
☐ 如果误差 > 10米，检查参数或微调
```

---

## 附录：常用传感器尺寸对照表（完整版）

| 传感器标注 | 对角线(mm) | 宽度(mm) | 高度(mm) | 常见用途 |
|----------|-----------|---------|---------|---------|
| 1" | 16.0 | 13.2 | 8.8 | 高端无人机 |
| 1/1.2" | 13.3 | 10.67 | 8.0 | 专业无人机 |
| 1/1.28" | 12.5 | 9.96 | 7.47 | DJI Phantom |
| 1/1.32" | 12.1 | 9.68 | 7.26 | M3系列 |
| 1/1.7" | 9.4 | 7.6 | 5.7 | 消费级无人机 |
| 1/2" | 8.0 | 6.4 | 4.8 | 标准 |
| 1/2.3" | 6.9 | 6.17 | 4.55 | 最常见 |

---

**编制**：无人机巡检系统技术团队  
**版本**：v1.0  
**日期**：2026年2月12日
